---
data_dir: /vector-data-dir
api:
  enabled: true
  address: 0.0.0.0:8686

#
# Sources
#

sources:
  mikrotik_source:
    type: vector
    version: "2"
    address: 0.0.0.0:6000

  kubernetes_source:
    type: vector
    version: "2"
    address: 0.0.0.0:6010

  kubernetes_ingress_source:
    type: vector
    version: "2"
    address: 0.0.0.0:6013
#
# Transforms
#

transforms:
  # kubernetes_remap:
  #   type: remap
  #   inputs: ["kubernetes_source"]
  #   source: |
  #     # Standardize 'app' index
  #     .app = .pod_labels."app.kubernetes.io/name" || .pod_labels.app || .pod_labels."k8s-app" || "unknown"
  #     # Drop pod_labels
  #     del(.pod_labels)
  #     .namespace = .kubernetes.pod_namespace
  #     del(.kubernetes.pod_namespace)
  #     .node = .kubernetes.pod_node_name
  #     del(.kubernetes.pod_node_name)
  kubernetes_ingress_remap:
    type: remap
    inputs: ["kubernetes_ingress_source"]
    source: |
      .log = parse_json!(.message)
      del(.message)
#
# Sinks
#

sinks:
  mikrotik:
    inputs: ["mikrotik_source"]
    type: elasticsearch
    endpoints:
      - http://vm-logs-victoria-logs-single-server.monitoring.svc:9428/insert/elasticsearch/
    mode: "bulk"
    compression: gzip
    api_version: "v8"
    healthcheck:
      enabled: false
    query:
      _msg_field: "message"
      _stream_fields: "hostname"
  # kubernetes:
  #   inputs: ["kubernetes_source"]
  #   type: elasticsearch
  #   endpoints:
  #     - http://vm-logs-victoria-logs-single-server.monitoring.svc:9428/insert/elasticsearch/
  #   mode: "bulk"
  #   compression: gzip
  #   api_version: "v8"
  #   healthcheck:
  #     enabled: false
  #   query:
  #     _msg_field: "message"
  #     _stream_fields: ",kubernetes.pod_namespace"
  #     debug: "1"
  ingress:
    inputs: ["kubernetes_ingress_remap"]
    type: elasticsearch
    endpoints:
      - http://vm-logs-victoria-logs-single-server.monitoring.svc:9428/insert/elasticsearch/
    mode: "bulk"
    compression: gzip
    api_version: "v8"
    healthcheck:
      enabled: false
    query:
      _msg_field: "log.msg"
      _stream_fields: "vhost"
