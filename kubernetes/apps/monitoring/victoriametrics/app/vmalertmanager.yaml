---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlertmanagerConfig
metadata:
  name: telegram
  namespace: monitoring
spec:
  route:
    receiver: telegram
  receivers:
    - name: "telegram"
      telegram_configs:
        - bot_token:
            key: token
            name: vmalert-telegram-token
          api_url: https://api.telegram.org
          chat_id: 104243855
          parse_mode: "HTML"
          send_resolved: true
          message: |-
            {{ define "alert_list" }}{{ range . }}
            ---
            ğŸªª <b>{{ .Labels.alertname }}</b>
            {{- if eq .Labels.severity "critical" }}
            ğŸš¨ CRITICAL ğŸš¨ {{ end }}
            {{- if eq .Labels.severity "warning" }}
            âš ï¸ WARNING âš ï¸{{ end }}
            {{- if .Annotations.summary }}
            ğŸ“ {{ .Annotations.summary }}{{ end }}
            {{- if .Annotations.description }}
            ğŸ“– {{ .Annotations.description }}{{ end }}

            ğŸ· Labels:
            {{ range .Labels.SortedPairs }}  <i>{{ .Name }}</i>: <code>{{ .Value }}</code>
            {{ end }}{{ end }}
            {{ end }}

            {{ define "telegram.message" }}
            {{ if gt (len .Alerts.Firing) 0 }}
            ğŸ”¥ Alerts Firing ğŸ”¥
            {{ template "alert_list" .Alerts.Firing }}
            {{ end }}
            {{ if gt (len .Alerts.Resolved) 0 }}
            âœ… Alerts Resolved âœ…
            {{ template "alert_list" .Alerts.Resolved }}
            {{ end }}
            {{ end }}
