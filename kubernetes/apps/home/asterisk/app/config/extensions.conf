; Asterisk Dialplan for DVC DX470 Intercom

[general]
static=yes
writeprotect=no

[globals]

; ===========================================
; Inbound calls from intercom (doorbell pressed)
; ===========================================
[intercom-inbound]
; When intercom calls any extension, ring all dashboards
exten => _X.,1,NoOp(Incoming call from Door Intercom to ${EXTEN})
 same => n,Set(CALLERID(name)=Door Intercom)
 same => n,Set(CALLERID(num)=8000)
 ; Ring all registered dashboard endpoints for 60 seconds
 same => n,Dial(PJSIP/homeassistant&PJSIP/dashboard-101&PJSIP/dashboard-102,60,m)
 same => n,Hangup()

; ===========================================
; Default context for internal calls
; ===========================================
[default]
; Call the intercom
exten => 8000,1,NoOp(Calling Door Intercom)
 same => n,Dial(PJSIP/intercom,60)
 same => n,Hangup()

; Call specific dashboards
exten => 100,1,Dial(PJSIP/homeassistant,60)
 same => n,Hangup()

exten => 101,1,Dial(PJSIP/dashboard-101,60)
 same => n,Hangup()

exten => 102,1,Dial(PJSIP/dashboard-102,60)
 same => n,Hangup()

; Ring all dashboards
exten => 199,1,NoOp(Ringing all dashboards)
 same => n,Dial(PJSIP/homeassistant&PJSIP/dashboard-101&PJSIP/dashboard-102,60,m)
 same => n,Hangup()

; DTMF to unlock door (send back to intercom)
; The intercom typically listens for DTMF to trigger door unlock
exten => *1,1,NoOp(Door unlock requested)
 same => n,Playback(beep)
 same => n,Hangup()
