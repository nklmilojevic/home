---
apiVersion: v1
kind: ConfigMap
metadata:
  name: browser-phone-config
data:
  config.js: |
    var config = {
      wssServer: "wss://asterisk.nikola.wtf/ws",
      ServerPath: "/ws",
      SipUsername: "101",
      SipPassword: "hass123",
      SipDomain: "asterisk.nikola.wtf",
      StunServer: "stun:stun.l.google.com:19302",
      VoiceMailNumber: "*97",
      SubscribeToVoicemail: false,
      ShowCallAnswerConfirmation: false,
      AutoAnswerEnabled: false,
      DoNotDisturbEnabled: false,
      StartVideoFullScreen: true,
      SelectRingingLine: true,
    };
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: browser-phone
spec:
  replicas: 1
  selector:
    matchLabels:
      app: browser-phone
  template:
    metadata:
      labels:
        app: browser-phone
    spec:
      containers:
        - name: browser-phone
          image: nginx:alpine
          ports:
            - containerPort: 80
          volumeMounts:
            - name: config
              mountPath: /usr/share/nginx/html/config.js
              subPath: config.js
      volumes:
        - name: config
          configMap:
            name: browser-phone-config
---
apiVersion: v1
kind: Service
metadata:
  name: browser-phone
spec:
  selector:
    app: browser-phone
  ports:
    - port: 80
      targetPort: 80
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: browser-phone
spec:
  hostnames:
    - phone.nikola.wtf
  parentRefs:
    - name: internal
      namespace: kube-system
      sectionName: https
  rules:
    - backendRefs:
        - name: browser-phone
          port: 80
