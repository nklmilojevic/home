---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: redis-cluster
spec:
  interval: 1h
  timeout: 5m
  chartRef:
    kind: OCIRepository
    name: ot-operator-cluster
  install:
    crds: CreateReplace
    remediation:
      retries: -1
  upgrade:
    cleanupOnFail: true
    crds: CreateReplace
    remediation:
      retries: 5
  values:
    serviceMonitor:
      enabled: true
      interval: 30s
      scrapeTimeout: 10s
      namespace: monitoring
      # -- extraLabels are added to the servicemonitor when enabled set to true
      extraLabels:
        {}
        # foo: bar
        # team: devops

    redisExporter:
      enabled: true
      image: quay.io/opstree/redis-exporter
      tag: "v1.44.0"
      imagePullPolicy: IfNotPresent
      resources:
        {}
        # requests:
        #   cpu: 100m
        #   memory: 128Mi
        # limits:
        #   cpu: 100m
        #   memory: 128Mi
      env:
        []
        # - name: VAR_NAME
        #   value: "value1"
      securityContext: {}

    storageSpec:
      volumeClaimTemplate:
        spec:
          # storageClassName: standard
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi
      nodeConfVolume: true
      nodeConfVolumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi
      #   selector: {}

    podSecurityContext:
      runAsUser: 1000
      fsGroup: 1000
