---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: democratic-csi
  namespace: kube-system
spec:
  interval: 15m
  chart:
    spec:
      # renovate: registryUrl=https://democratic-csi.github.io/charts/
      chart: democratic-csi
      version: 0.13.5
      sourceRef:
        kind: HelmRepository
        name: democratic-csi
        namespace: flux-system
      interval: 15m
  install:
    createNamespace: true
    remediation:
      retries: 5
  upgrade:
    remediation:
      retries: 5
  values:
    csiDriver:
      # should be globally unique for a given cluster
      name: "org.democratic-csi.smb"

    storageClasses:
      - name: smb-csi
        defaultClass: false
        reclaimPolicy: Delete
        volumeBindingMode: Immediate
        allowVolumeExpansion: false
        parameters:
          fsType: cifs
    driver:
      config:
        driver: smb-client
        instance_id:
        smb:
          shareHost: 10.5.0.10
          shareBasePath: "pvc"
          # shareHost:shareBasePath should be mounted at this location in the controller container
          controllerBasePath: "/storage"
          dirPermissionsMode: "0777"
          dirPermissionsUser: root
          dirPermissionsGroup: wheel
